@(user: User)(users: List[User])(implicit webJarsUtil: org.webjars.play.WebJarsUtil, flash: Flash)

@main(user)(s"Nouvelle demande")  {
<link rel="stylesheet" href="https://cdn.rawgit.com/Pixabay/JavaScript-autoComplete/1.0.4/auto-complete.css" />
<script src="https://cdn.rawgit.com/Pixabay/JavaScript-autoComplete/1.0.4/auto-complete.min.js"></script>
<style>
    .mdl-data-table td {
        padding: 0px 18px;
    }
    .invisible {
        display: none;
    }
</style>
}{
<div class="mdl-color--white mdl-shadow--2dp mdl-cell mdl-cell--12-col mdl-grid">
    <h3 class="mdl-cell mdl-cell--12-col">Nouvelle demande</h3>
    <form action="@routes.ApplicationController.createPost()" class="mdl-cell mdl-cell--12-col mdl-grid mdl-grid--no-spacing" method="post">
        <div class="mdl-cell mdl-cell--12-col mdl-grid">
            <h5 class="mdl-cell mdl-cell--12-col">Sujet</h5>
            <form action="#">
                <div class="mdl-textfield mdl-js-textfield">
                    <input class="mdl-textfield__input" type="text" id="sample1" name="subject">
                    <label class="mdl-textfield__label" for="sample1">Saisir le sujet de votre demande...</label>
                </div>
            </form>
            <h5 class="mdl-cell mdl-cell--12-col">Informations de l'usager</h5>
            <table class="mdl-data-table mdl-js-data-table mdl-shadow--2dp" id="form__infos">
                <tbody>
                    @for(info <- List("Prénom", "Nom de famille")) {
                        <tr>
                            <td class="mdl-data-table__cell--non-numeric">@info.capitalize</td>
                            <td class="mdl-data-table__cell--non-numeric"><div class="mdl-textfield mdl-js-textfield">
                                <input class="mdl-textfield__input" type="text" id="sample1" name="infos[@info]">
                                <label class="mdl-textfield__label" for="sample1">Saisir @info ici</label>
                            </div></td>
                            <td></td>
                        </tr>
                    }
                    <tr>
                        <td class="mdl-data-table__cell--non-numeric">
                            <select id="types" onchange="newTypeSelected()">
                                <option disabled selected value>Selectionnez une nouvelle information</option>
                                    @for(info <- List("Date de naissance", "Numéro de sécurité sociale", "Identifiant CAF", "Numéro de dossier", "Nom de Naissance", "Autre")) {
                                        <option value="@info">@info</option>
                                    }
                            </select><br>
                            <div class="mdl-textfield mdl-js-textfield invisible">
                                <label class="mdl-textfield__label" for="sample1">Saisissez le type d'information</label>
                                <input class="mdl-textfield__input"  type="text" id="other-type" onkeydown="if (event.keyCode === 13) { addInfo(); return false;}">
                            </div>
                        </td>
                        <td></td>
                        <td class="mdl-data-table__cell--non-numeric"><button class="mdl-button mdl-js-button mdl-button--fab" type="button" onclick="addInfo();">
                            <i class="material-icons">add</i>
                        </button></td>
                    </tr>
                </tbody>
            </table>
            <br>
            <h5 class="mdl-cell mdl-cell--12-col">Description</h5>
            <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label mdl-cell mdl-cell--12-col">
                <textarea class="mdl-textfield__input" type="text" rows= "5" id="sample5" style="width: 100%;" name="description"></textarea>
                <label class="mdl-textfield__label" for="sample5">Détaillez votre demande ...</label>
            </div>
            <br>
            <h5 class="mdl-cell mdl-cell--12-col">Envoyer la demande à</h5>
            <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label mdl-cell mdl-cell--12-col">
                <input class="mdl-textfield__input" type="text" id="search" onkeyup="filterUsers()">
                <label class="mdl-textfield__label" for="search">Rechercher une personne, un organisme...</label>
            </div>
            <div class="mdl-cell mdl-cell--12-col mdl-grid" style="max-height: 500px; overflow-y: auto;">
                <table class="mdl-data-table mdl-js-data-table mdl-shadow--2dp mdl-cell mdl-cell--12-col" id="users">
                    <thead>
                    <tr>
                        <th class="mdl-data-table__cell--non-numeric"></th>
                        <th class="mdl-data-table__cell--non-numeric">Nom</th>
                        <th class="mdl-data-table__cell--non-numeric">Qualité</th>
                    </tr>
                    </thead>
                    <tbody>
                    @for(user <- users) {
                        <tr>
                            <td>
                                <label class="mdl-checkbox mdl-js-checkbox mdl-js-ripple-effect mdl-js-ripple-effect--ignore-events">
                                    <input type="checkbox" class="mdl-checkbox__input" name="users[]" value="@user.id">
                                </label>
                            </td>
                            <td class="mdl-data-table__cell--non-numeric">@user.name</td>
                            <td class="mdl-data-table__cell--non-numeric">@user.qualite</td>
                        </tr>
                    }
                    </tbody>
                </table>
            </div>
            <br>
            <button id="review-validation" class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored mdl-cell mdl-cell--10-col mdl-cell--1-offset">
                Envoyer ma demande
            </button>
        </div>
    </form>
</div>
<script type="text/javascript">
    function filterUsers() {
          var filter = document.getElementById("search").value.toUpperCase();
          Array.from(document.querySelectorAll("#users tbody tr")).forEach(function(tr){
            if (tr.innerText.toUpperCase().indexOf(filter) > -1) {
                tr.style.display = "";
            } else {
                tr.style.display = "none";
            }
          });
    }

    function newTypeSelected() {
        var select = document.getElementById("types");
        var otherTypeElement = document.getElementById("other-type");
        if(select.value == "Autre") {
            otherTypeElement.value = "";
            otherTypeElement.parentNode.classList.remove("invisible");
            //componentHandler.upgradeElements(otherTypeElem.parentNode.parentNode.getElementsByTagName("*"));
            componentHandler.upgradeDom();
        } else {
            otherTypeElement.parentNode.classList.add("invisible");
            otherTypeElement.value = select.value;
        }
    }
    newTypeSelected();

    function removeInfo(elem) {
        var row = elem.parentNode.parentNode;
        row.parentNode.removeChild(row);
    }

    function addInfo() {
        var inputInfoName = document.getElementById("other-type");
        var infoName = inputInfoName.value;
        if(infoName == "") { return; }
        var newNode = document.createElement('tr');
        newNode.innerHTML = '<td class="mdl-data-table__cell--non-numeric">'+infoName+'</td> \
                        <td class="mdl-data-table__cell--non-numeric"><div class="mdl-textfield mdl-js-textfield"> \
                            <input class="mdl-textfield__input" type="text" id="sample1" name="infos['+infoName+']"> \
                            <label class="mdl-textfield__label info__label" for="sample1">Saisir '+infoName+'</label> \
                        </div></td> \
                        <td class="mdl-data-table__cell--non-numeric"> \
                        <button class="mdl-button mdl-js-button mdl-button--fab" type="button" onclick="removeInfo(this);"> \
                            <i class="material-icons">remove</i> \
                        </button></td>';

        inputInfoName.parentNode.parentNode.parentNode.parentNode.insertBefore(newNode, inputInfoName.parentNode.parentNode.parentNode);
        inputInfoName.value = "";
        inputInfoName.parentNode.classList.remove("is-dirty");
        componentHandler.upgradeElements(newNode);
    }
</script>
}
