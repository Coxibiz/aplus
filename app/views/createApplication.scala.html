@(user: User)(implicit webJarAssets: WebJarAssets, flash: Flash)

@main(user)(s"Nouvelle demande")  {
<link rel="stylesheet" href="https://cdn.rawgit.com/Pixabay/JavaScript-autoComplete/1.0.4/auto-complete.css" />
<script src="https://cdn.rawgit.com/Pixabay/JavaScript-autoComplete/1.0.4/auto-complete.min.js"></script>
<style>
    .mdl-data-table td {
        padding: 0px 18px;
    }
    .invisible {
        display: none;
    }
</style>
}{
<div class="mdl-color--white mdl-shadow--2dp mdl-cell mdl-cell--12-col mdl-grid">
    <h3 class="mdl-cell mdl-cell--12-col">Nouvelle demande</h3>
    <form action="@routes.ApplicationController.createPost()" class="mdl-cell mdl-cell--12-col mdl-grid mdl-grid--no-spacing" method="post">
        <div class="mdl-cell mdl-cell--12-col mdl-grid">
            <h5 class="mdl-cell mdl-cell--12-col">Sujet</h5>
            <form action="#">
                <div class="mdl-textfield mdl-js-textfield">
                    <input class="mdl-textfield__input" type="text" id="sample1" name="subject">
                    <label class="mdl-textfield__label" for="sample1">Saisir le sujet de votre demande...</label>
                </div>
            </form>
            <h5 class="mdl-cell mdl-cell--12-col">Informations du demandeur</h5>
            <table class="mdl-data-table mdl-js-data-table mdl-shadow--2dp" id="form__infos">
                <tbody>
                    <tr style="display: none;">
                        <td class="mdl-data-table__cell--non-numeric"><button class="mdl-button mdl-js-button mdl-button--fab" type="button" onclick="removeInfo(this);">
                            <i class="material-icons">remove</i>
                        </button></td>
                        <td class="mdl-data-table__cell--non-numeric info__name"></td>
                        <td class="mdl-data-table__cell--non-numeric"><div class="mdl-textfield mdl-js-textfield">
                            <input class="mdl-textfield__input" type="text" id="sample1">
                            <label class="mdl-textfield__label info__label" for="sample1"></label>
                        </div></td>
                    </tr>
                    @for(info <- List("Prénom", "Nom de famille")) {
                        <tr>
                            <td></td>
                            <td class="mdl-data-table__cell--non-numeric">@info.capitalize</td>
                            <td class="mdl-data-table__cell--non-numeric"><div class="mdl-textfield mdl-js-textfield">
                                <input class="mdl-textfield__input" type="text" id="sample1" name="infos[@info]">
                                <label class="mdl-textfield__label" for="sample1">Saisir @info ici</label>
                            </div></td>
                        </tr>
                    }
                    <tr>
                        <td></td>
                        <td class="mdl-data-table__cell--non-numeric">
                            <select id="types" onchange="newTypeSelected()">
                                @for(info <- List("Date de naissance", "Numéro de sécurité sociale", "Identifiant CAF", "Numéro de dossier", "Nom de Naissance", "Autre")) {
                                    <option value="@info">@info</option>
                                }
                            </select><br>
                            <div class="mdl-textfield mdl-js-textfield invisible">
                                <label class="mdl-textfield__label" for="sample1">Saisissez le type d'information</label>
                                <input class="mdl-textfield__input"  type="text" id="other-type" onkeydown="if (event.keyCode === 13) { addInfo(); return false;}">
                            </div>
                        </td>
                        <td class="mdl-data-table__cell--non-numeric"><button class="mdl-button mdl-js-button mdl-button--fab" type="button" onclick="addInfo();">
                            <i class="material-icons">add</i>
                        </button></td>
                    </tr>
                </tbody>
            </table>
            <h5 class="mdl-cell mdl-cell--12-col">Description</h5>
            <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label mdl-cell mdl-cell--12-col">
                <textarea class="mdl-textfield__input" type="text" rows= "5" id="sample5" style="width: 100%;" name="description"></textarea>
                <label class="mdl-textfield__label" for="sample5">Détaillez votre demande ...</label>
            </div>
            <br>
            <button id="review-validation" class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored mdl-cell mdl-cell--10-col mdl-cell--1-offset">
                Envoyer ma demande
            </button>
        </div>
    </form>
</div>
<script>
    function newTypeSelected() {
        var select = document.getElementById("types");
        if(select.value == "Autre") {
            document.getElementById("other-type").value = "";
            document.getElementById("other-type").parentNode.classList.remove("invisible");
        } else {
            document.getElementById("other-type").parentNode.classList.add("invisible");
            document.getElementById("other-type").value = select.value;
        }
    }
    newTypeSelected();

    function removeInfo(elem) {
        var row = elem.parentNode.parentNode;
        row.parentNode.removeChild(row);
    }

    function addInfo() {
        var inputInfoName = document.getElementById("other-type");
        var infoName = inputInfoName.value;
        var newNode = document.getElementById("form__infos").querySelectorAll("tbody tr")[0].cloneNode(true);
        newNode.style = '';
        newNode.getElementsByClassName("info__name")[0].name = "infos["+infoName+"]";
        newNode.getElementsByClassName("info__name")[0].innerText = infoName;
        newNode.getElementsByClassName("info__label")[0].innerText = "Saisir "+infoName;

        inputInfoName.parentNode.parentNode.parentNode.parentNode.insertBefore(newNode, inputInfoName.parentNode.parentNode.parentNode);
        inputInfoName.value = "";
        inputInfoName.parentNode.classList.remove("is-dirty");
    }
</script>
}
