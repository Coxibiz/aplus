@(user: User)(application: Application)(implicit webJarsUtil: org.webjars.play.WebJarsUtil, flash: Flash)
@import java.util.Locale

@main(user)(s"Demande ${application.id}: ${application.subject} ")  {
<style>
.mdl-list__item-primary-content {
    font-weight: bold;
}
.map__leaflet {
    height: 250px;
}
.application__key {
    width: 40%;
    font-weight: bold;
}
.application__value {
    width: 60%;
    white-space: pre-wrap;
}
.application {
    white-space: normal;
}

@@media screen and (max-width: 600px) {
    .mdl-data-table__cell--non-numeric {
        display: block;
        float: left;
        width: 100%;
        height: initial !important;
    }
}

div hr {
    width: 95%;
    margin: 0px auto;
}
div hr:last-child {
    display: none;
}

</style>
}{
<table class="application mdl-data-table mdl-js-data-table mdl-cell mdl-cell--12-col mdl-cell--12-col-phone mdl-cell--8-col-print mdl-shadow--2dp" style="table-layout: fixed; ">
<tbody>
<tr>
    <td class="mdl-data-table__cell--non-numeric application__key">Date</td>
    <td class="mdl-data-table__cell--non-numeric application__value">@application.creationDate.toString("dd MMM YYYY", new Locale("fr"))</td>
</tr>
<tr>
    <td class="mdl-data-table__cell--non-numeric application__key">Etat</td>
    <td class="mdl-data-table__cell--non-numeric application__value">@application.status</td>
</tr>
<tr>
    <td class="mdl-data-table__cell--non-numeric application__key" >Sujet</td>
    <td class="mdl-data-table__cell--non-numeric application__value">@application.subject</td>
</tr>
<tr>
    <td class="mdl-data-table__cell--non-numeric application__key" >Détails</td>
    <td class="mdl-data-table__cell--non-numeric application__value">@application.description</td>
</tr>
<tr>
    <td class="mdl-data-table__cell--non-numeric application__key">De</td>
    <td class="mdl-data-table__cell--non-numeric application__value">@application.author</td>
</tr>
</tbody>
</table>

<table class="application mdl-data-table mdl-js-data-table mdl-cell mdl-cell--12-col mdl-cell--12-col-phone mdl-cell--8-col-print mdl-shadow--2dp" style="table-layout: fixed; ">
    <thead>
    <tr><td rowspan="2"><b>Information du l'usager</b></td></tr>
    </thead>
    <tbody>
@for((key, value) <- application.userInfos) {
<tr>
    <td class="mdl-data-table__cell--non-numeric application__key">@key</td>
    <td class="mdl-data-table__cell--non-numeric application__value">@value</td>
</tr>
}
</tbody>
</table>
@for(answer <- Answer.forApplicationId(application.id)){
@if(user.instructor || answer.last) {
<div class="mdl-color--white mdl-shadow--2dp mdl-cell mdl-cell--12-col mdl-grid">
    <h4 class="mdl-cell mdl-cell--12-col">Message de @answer.author.name (@answer.author.qualite) le @answer.creationDate.toString("dd MMM YYYY", new Locale("fr"))</h4>
    <span class="mdl-cell mdl-cell--12-col">@answer.message</span><br>
    <ul class="mdl-cell mdl-cell--12-col">
    @for(invited <- answer.users) {
        <li>@invited.name (@invited.qualite) a été invité sur la demande</li>
    }
    </ul>
</div>
}
}

@if(user.instructor) {
<div class="mdl-color--white mdl-shadow--2dp mdl-cell mdl-cell--6-col mdl-grid">
    <h3 class="mdl-cell mdl-cell--12-col">Je peux répondre à la demande</h3>
    <form action="@routes.ApplicationController.answer(application.id)" class="mdl-cell mdl-cell--12-col mdl-grid mdl-grid--no-spacing" method="post" onsubmit="">
        <div class="mdl-cell mdl-cell--12-col mdl-grid">
            <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label mdl-cell mdl-cell--12-col">
                <textarea class="mdl-textfield__input" type="text" rows= "5" id="sample5" style="width: 100%;" name="message"></textarea>
                <label class="mdl-textfield__label" for="sample5">Détaillez votre réponse ici...</label>
            </div>
            <b>Votre réponse permet d'indiquer le statut des démarches et procédures en cours. Merci d'utiliser vos outils habituels pour continuer l'instruction.</b>
            <button id="review-validation" class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored mdl-cell mdl-cell--12-col">
                 Répondre à la demande
            </button>
        </div>
    </form>
</div>
<div class="mdl-color--white mdl-shadow--2dp mdl-cell mdl-cell--6-col mdl-grid do-not-print">
    <h3 class="mdl-cell mdl-cell--12-col">Inviter un A+</h3>
    <form action='@routes.ApplicationController.invite(application.id)' class="mdl-cell mdl-cell--12-col" method="post">
        <table class="mdl-data-table mdl-js-data-table mdl-shadow--2dp mdl-cell mdl-cell--12-col">
            <thead>
            <tr>
                <th class="mdl-data-table__cell--non-numeric"></th>
                <th class="mdl-data-table__cell--non-numeric">Nom</th>
                <th class="mdl-data-table__cell--non-numeric">Qualité</th>
            </tr>
            </thead>
            <tbody>
            @for(user <- User.all.filter(_.instructor)) {
                <tr>
                    <td>
                        <label class="mdl-checkbox mdl-js-checkbox mdl-js-ripple-effect mdl-js-ripple-effect--ignore-events">
                            <input type="checkbox" class="mdl-checkbox__input" name="users[]" value="@user.id">
                        </label>
                    </td>
                    <td class="mdl-data-table__cell--non-numeric">@user.name</td>
                    <td class="mdl-data-table__cell--non-numeric">@user.qualite</td>
                </tr>
            }
            </tbody>
        </table>
        <h5>Ajouter un commentaire</h5>
        <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label mdl-cell mdl-cell--12-col">
            <textarea class="mdl-textfield__input" type="text" rows= "5" id="sample5" style="width: 100%;" name="message"></textarea>
            <label class="mdl-textfield__label" for="sample5">Laisser ici le commentaire pour l'invitation...</label>
        </div>
        <b>Note : Ce commentaire sera visible par tous les agents A+. L'auteur de la demande (@application.author) ne pourra pas le voir.</b>
        <button id="application-complete" class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored mdl-cell mdl-cell--12-col">Inviter les A+ sélectionnés</button>
    </form>
</div>
}
}
